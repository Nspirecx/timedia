<!DOCTYPE html>
<html>
<head>
  <title>Pay with TiPay</title>
  <link rel="stylesheet" href="other resources/style.css">
  <link rel="stylesheet" href="other resources/style2.css">
</head>
<body>
<script>
function getQueryVariable(variable)
{
       var query = window.location.search.substring(1);
       var vars = query.split("&");
       for (var i=0;i<vars.length;i++) {
               var pair = vars[i].split("=");
               if(pair[0] == variable){return pair[1];}
       }
       return(false);
}

var amount = Number(atob(getQueryVariable("code")).split("&")[0]);
var code = atob(getQueryVariable("code")).split("&")[1];

function pay() {
  if (localStorage.points < amount) {
    alert("Insufficient funds.");
  } else if (amount == 1) {
    var paymessage = confirm("Are you sure you would like to pay 1 TiPoint?");
  } else {
    var paymessage = confirm("Are you sure you would like to pay " + amount + " TiPoints?");
  }
  
  if (paymessage) {
    localStorage.points = localStorage.points - amount;
    alert("Purchase completed.");
    eval(code);
    window.location.href = "index.html?app=1";
  }
}
</script>
<button style="width: 150px; height: 35px; font-size: 13px;" class="btn btn-primary" onclick="pay()">Pay with TiPay</button>
  <script src="js/db.js"></script>
</body>
</html>
